# Phase 13: カメラ表示の仕組み

## カテゴリ
機能編

## 概要
カメラ撮影画像のLCD表示の仕組みを解析し、画像データフローを理解する。

## 解析要求事項

カメラ撮影画像のLCD表示の仕組みを解析してください。

### 1. カメラハードウェア

#### カメラセンサの仕様

| 項目 | 値 |
|------|-----|
| センサ型番 | ? |
| 解像度 | ? x ? |
| フレームレート | ? fps |
| 出力形式 | YUV422 / RGB565 / RAW |
| インターフェース | MIPI-CSI / パラレル (CEU) |

#### MIPI-CSI設定（MIPI接続の場合）

| 項目 | 設定値 |
|------|--------|
| レーン数 | ? |
| データレート | ? Mbps/lane |
| 仮想チャネル | ? |

#### CEU設定（パラレル接続の場合）

| 項目 | 設定値 |
|------|--------|
| データ幅 | 8bit / 16bit |
| 同期方式 | 外部同期 / 内蔵同期 |
| クロック周波数 | ? MHz |

#### VIN（Video Input Module）の設定

| 項目 | 設定値 |
|------|--------|
| 入力フォーマット | ? |
| 出力フォーマット | ? |
| キャプチャサイズ | ? x ? |

### 2. 画像データフロー

#### データ取得フロー

```
カメラセンサ
    │
    │ MIPI-CSI / パラレル
    ▼
MIPI-CSI I/F / CEU
    │
    │ DMA転送
    ▼
VIN (Video Input Module)
    │
    │ フォーマット変換
    ▼
キャプチャバッファ (SDRAM)
    │
    │ 転送/コピー
    ▼
フレームバッファ (SDRAM)
    │
    │ GLCDC読み出し
    ▼
LCD表示
```

#### 画像フォーマット

| ステージ | フォーマット | サイズ |
|----------|-------------|--------|
| センサ出力 | YUV422 / RGB565 | ? x ? |
| VIN出力 | ? | ? x ? |
| 表示用 | RGB565 / RGB888 | ? x ? |

#### バッファの構成

| バッファ種別 | 数 | サイズ | アドレス |
|-------------|-----|--------|----------|
| キャプチャバッファ | ? | ? bytes | 0x???????? |
| 表示バッファ | ? | ? bytes | 0x???????? |

### 3. 画像変換処理

#### カラーフォーマット変換

| 変換 | 方式 |
|------|------|
| YUV → RGB | ハードウェア(VIN) / ソフトウェア |
| リサイズ | ハードウェア / ソフトウェア |

#### リサイズ処理

| 項目 | 値 |
|------|-----|
| 入力サイズ | ? x ? |
| 出力サイズ | ? x ? |
| 方式 | ニアレスト / バイリニア |

#### ハードウェアアクセラレータの使用

| 処理 | 使用機能 |
|------|----------|
| スケーリング | VIN |
| フォーマット変換 | VIN |
| 回転 | DRW (使用している場合) |

### 4. LCD表示への転送

#### 転送方式

| 方式 | 説明 |
|------|------|
| 直接参照 | GLCDCがキャプチャバッファを直接参照 |
| DMA転送 | キャプチャ→フレームバッファへDMA転送 |
| CPUコピー | ソフトウェアでバッファ間コピー |

実際の方式: ?

#### フレームレート制御

| 項目 | 値 |
|------|-----|
| カメラフレームレート | ? fps |
| 表示フレームレート | ? fps |
| 同期方式 | ? |

### 5. プレビュー処理のフロー

#### 初期化フロー

```
カメラ初期化
    │
    ├─→ センサ設定 (I2C)
    │
    ├─→ MIPI-CSI/CEU設定
    │
    ├─→ VIN設定
    │
    └─→ バッファ確保
    │
    ▼
キャプチャ開始
```

#### フレーム処理フロー

```
フレーム受信割込み
    │
    ▼
割込みハンドラ
    │
    ├─→ バッファ切り替え
    │
    └─→ コールバック通知
    │
    ▼
表示更新処理
    │
    ├─→ フォーマット変換（必要時）
    │
    ├─→ フレームバッファ更新
    │
    └─→ GLCDC更新
```

#### 停止フロー

```
キャプチャ停止要求
    │
    ▼
VIN停止
    │
    ▼
バッファ解放
    │
    ▼
リソース解放
```

## 期待する成果物

### 1. カメラシステムブロック図

カメラセンサからLCD表示までの全体ブロック図を作成してください。

### 2. データフロー図

画像データの流れを詳細に図示してください。

```
┌─────────────┐    MIPI     ┌─────────────┐    DMA     ┌─────────────┐
│   Camera    │────────────→│ MIPI-CSI/VIN│──────────→│  Buffer A   │
│   Sensor    │             │             │           │  (Capture)  │
└─────────────┘             └─────────────┘           └──────┬──────┘
                                                             │
                                                             │ コピー/参照
                                                             ▼
┌─────────────┐    読出し   ┌─────────────┐           ┌─────────────┐
│    LCD      │←───────────│   GLCDC     │←──────────│  Buffer B   │
│   Panel     │             │             │           │  (Display)  │
└─────────────┘             └─────────────┘           └─────────────┘
```

### 3. フレームタイミング図

フレーム取得と表示のタイミング関係を図示してください。

### 4. 主要API/関数一覧

| 関数名 | 役割 | 呼び出し元 |
|--------|------|-----------|
| camera_init() | 初期化 | アプリ |
| camera_start() | キャプチャ開始 | アプリ |
| camera_stop() | キャプチャ停止 | アプリ |
| frame_callback() | フレーム完了通知 | ISR |

### 5. パフォーマンス情報

- 実測フレームレート
- 遅延時間
- CPU負荷
