# Phase 8: レイヤー分類

## カテゴリ
アーキテクチャ編

## 概要
ソフトウェアを機能レイヤーに分類し、各レイヤーの責務と依存関係を明確にする。

## 解析要求事項

このプロジェクトのソフトウェアを以下のレイヤーに分類し、各レイヤーのファイルと役割を詳細に説明してください。

### レイヤー分類

#### 1. アプリケーション層

**責務：**
- メインアプリケーションロジック
- 画面制御、ユーザー操作処理
- ビジネスロジック

**調査項目：**
- アプリケーション固有のソースファイル
- 画面ごとの処理モジュール
- イベントハンドラ

#### 2. ミドルウェア層

**責務：**
- 上位レイヤーへの機能提供
- 複雑な処理の抽象化

**調査項目：**
- GUIライブラリ（emWin, GUIX, LVGLなど）
- 画像処理ライブラリ
- ファイルシステム（使用している場合）
- 通信プロトコルスタック
- その他のミドルウェア

#### 3. OS/アプリケーションインターフェース層

**責務：**
- RTOSのAPI呼び出し
- タスク間通信の管理

**調査項目：**
- RTOSラッパー関数
- タスク間通信のヘルパー
- OS抽象化レイヤー

#### 4. HAL（Hardware Abstraction Layer）層

**責務：**
- ハードウェアの抽象化
- 周辺機能への統一インターフェース

**調査項目：**
- FSPのHALドライバ
- `r_xxx` モジュール
- 周辺機能の抽象化API

#### 5. デバイスドライバ層

**責務：**
- 外部デバイスの制御
- デバイス固有のプロトコル実装

**調査項目：**
- タッチコントローラドライバ
- カメラセンサドライバ
- LCDパネル初期化ドライバ
- その他の外部ICドライバ

#### 6. 割込みハンドラ層

**責務：**
- ハードウェア割込みの処理
- 割込みコンテキストでの処理

**調査項目：**
- 割込みハンドラ関数
- コールバック関数
- ISR内の処理内容

### 出力形式

#### ファイル分類表

| レイヤー | ファイル | 役割 |
|----------|----------|------|
| アプリケーション | src/app_main.c | メインアプリ |
| アプリケーション | src/screen_home.c | ホーム画面 |
| ミドルウェア | src/gui_handler.c | GUI処理 |
| HAL | ra/fsp/src/r_glcdc/r_glcdc.c | LCD制御 |
| ... | ... | ... |

#### 依存関係図

```
┌─────────────────────────────────────────────────┐
│              アプリケーション層                    │
│  (app_main.c, screen_*.c)                       │
└────────────────────┬────────────────────────────┘
                     │ 呼び出し
                     ▼
┌─────────────────────────────────────────────────┐
│               ミドルウェア層                      │
│  (GUI Library, Image Processing)                │
└────────────────────┬────────────────────────────┘
                     │ 呼び出し
                     ▼
┌─────────────────────────────────────────────────┐
│        OS / アプリケーション I/F層               │
│  (RTOS API, Task Communication)                 │
└────────────────────┬────────────────────────────┘
                     │ 呼び出し
                     ▼
┌─────────────────────────────────────────────────┐
│                 HAL層                            │
│  (FSP HAL Drivers: r_glcdc, r_iic, ...)        │
└────────────────────┬────────────────────────────┘
                     │ レジスタアクセス
                     ▼
┌─────────────────────────────────────────────────┐
│              ハードウェア                         │
│  (GLCDC, I2C, MIPI-CSI, Timer, ...)            │
└─────────────────────────────────────────────────┘
```

## 期待する成果物

### 1. レイヤー別ファイル一覧

各レイヤーに属するすべてのソースファイルを列挙してください。

### 2. レイヤー間依存関係図

レイヤー間の呼び出し関係を図示してください。

### 3. 主要モジュールの説明

各レイヤーの主要モジュールについて、以下を説明してください：
- モジュールの責務
- 公開API/関数
- 他モジュールとの連携

### 4. 設計パターンの識別

使用されている設計パターン（あれば）を識別してください：
- コールバックパターン
- オブザーバーパターン
- ステートマシンパターン
- など
