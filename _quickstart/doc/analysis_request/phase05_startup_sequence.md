# Phase 5: 起動シーケンス解析

## カテゴリ
基盤編

## 概要
リセットベクタからmain関数までの処理の流れを詳細に解析し、システム起動の仕組みを理解する。

## 解析要求事項

リセットベクタからmain関数までの処理の流れを詳細に解析してください。

### 調査対象ファイル（優先順）

1. `startup_*.S` または `startup.c` - スタートアップコード
2. `system_*.c` - システム初期化
3. `bsp_*.c` - BSP初期化
4. `main.c` - メインエントリ

### 1. リセットベクタ

- リセットベクタの場所と定義
- ベクタテーブルの配置アドレス
- Reset_Handler関数の定義

### 2. スタックポインタの初期化

- MSP (Main Stack Pointer) の初期値
- PSP (Process Stack Pointer) の使用有無
- スタック領域のアドレスと サイズ

### 3. メモリ初期化

#### .data セクションの初期化
- ROM上の初期値の場所
- RAM上のコピー先
- コピー処理のコード

#### .bss セクションのゼロクリア
- 対象アドレス範囲
- ゼロクリア処理のコード

### 4. システム初期化

#### SystemInit関数
- クロックの初期設定
- キャッシュの設定
- MPU (Memory Protection Unit) の設定

#### その他のハードウェア初期化
- FPU有効化
- VTOR (Vector Table Offset Register) 設定

### 5. C言語ランタイムの初期化

- `__libc_init_array` の呼び出し
- 静的コンストラクタの実行（C++の場合）
- その他のランタイム初期化

### 6. main関数の呼び出し

- main関数への分岐
- main関数からのリターン時の処理

### 7. main関数内の初期化処理

- FSP初期化 (`R_FSP_VersionGet` など)
- BSP初期化 (`R_BSP_WarmStart` など)
- 周辺機能の初期化順序
- RTOS初期化（使用している場合）

### 8. デュアルコアの場合

- CM85 (CPU0) の起動シーケンス
- CM33 (CPU1) の起動シーケンス
- セカンダリコアの起動トリガー

## 期待する成果物

### 1. 呼び出しフロー図（テキストベース）

```
[リセット]
    │
    ▼
Reset_Handler (startup.S)
    │
    ├─→ スタックポインタ設定
    │
    ├─→ .data コピー
    │
    ├─→ .bss ゼロクリア
    │
    ├─→ SystemInit()
    │       │
    │       ├─→ クロック初期化
    │       └─→ キャッシュ/MPU設定
    │
    ├─→ __libc_init_array()
    │
    └─→ main()
            │
            ├─→ R_BSP_WarmStart()
            │
            ├─→ 周辺機能初期化
            │
            └─→ メインループ or RTOS起動
```

### 2. 各関数の役割説明

| 関数名 | ファイル | 役割 |
|--------|----------|------|
| Reset_Handler | startup.S | エントリポイント |
| SystemInit | system.c | システム初期化 |
| ... | ... | ... |

### 3. 重要な初期化処理のコード抜粋

関連するコードスニペットを抜粋し、コメント付きで説明してください。
