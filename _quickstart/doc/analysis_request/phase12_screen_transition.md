# Phase 12: 画面遷移の仕組み

## カテゴリ
機能編

## 概要
表示画面の切り替えを実現している技術を解析し、画面管理の仕組みを理解する。

## 解析要求事項

表示画面の切り替えを実現している技術を解析してください。

### 1. 画面管理方式

#### 画面（Screen/Window）の定義方法

調査項目：
- 画面を定義しているファイル
- 画面構造体/クラスの定義
- 画面IDの管理方法

```c
// 画面定義の例
typedef enum {
    SCREEN_ID_SPLASH,
    SCREEN_ID_HOME,
    SCREEN_ID_SETTINGS,
    SCREEN_ID_CAMERA,
    SCREEN_ID_MAX
} screen_id_t;

typedef struct {
    screen_id_t id;
    void (*init)(void);
    void (*draw)(void);
    void (*update)(void);
    void (*exit)(void);
} screen_t;
```

#### 画面の登録・管理を行う仕組み

| 管理項目 | 説明 |
|----------|------|
| 現在の画面 | 表示中の画面ID |
| 前の画面 | 遷移元の画面ID |
| 画面スタック | 履歴管理（あれば） |

### 2. 画面遷移のトリガー

#### タッチイベントによる遷移

| 操作 | 遷移先 | トリガー条件 |
|------|--------|-------------|
| ホームボタン | ホーム画面 | ボタンタッチ |
| 設定ボタン | 設定画面 | ボタンタッチ |
| 戻るボタン | 前画面 | ボタンタッチ |

#### タイマーによる自動遷移

| 条件 | 遷移内容 |
|------|----------|
| スプラッシュ表示後 | ホーム画面へ |
| 無操作タイムアウト | スクリーンセーバーへ |

#### 外部イベントによる遷移

| イベント | 遷移内容 |
|----------|----------|
| カメラ検出 | カメラ画面へ |
| エラー発生 | エラー画面へ |

### 3. 画面切り替え処理

#### 切り替えフロー

```
画面遷移要求
    │
    ▼
現在画面の終了処理
    │
    ├─→ リソース解放
    │
    ├─→ タイマー停止
    │
    └─→ exit()コールバック
    │
    ▼
新画面の初期化処理
    │
    ├─→ リソース読み込み
    │
    ├─→ 初期状態設定
    │
    └─→ init()コールバック
    │
    ▼
新画面の描画
    │
    └─→ draw()コールバック
    │
    ▼
画面表示更新
```

#### 遷移API

```c
// 遷移関数の例
void screen_transition(screen_id_t new_screen);
void screen_go_back(void);
```

### 4. 画面スタック/履歴

#### 「戻る」機能の実装有無

| 項目 | 状態 |
|------|------|
| 履歴管理 | 有/無 |
| 最大履歴数 | ? |
| 実装方式 | スタック/リスト |

#### 履歴管理の実装

```c
// 履歴スタックの例
#define SCREEN_HISTORY_MAX 10

static screen_id_t screen_history[SCREEN_HISTORY_MAX];
static int history_index = 0;

void screen_push(screen_id_t screen) {
    if (history_index < SCREEN_HISTORY_MAX) {
        screen_history[history_index++] = screen;
    }
}

screen_id_t screen_pop(void) {
    if (history_index > 0) {
        return screen_history[--history_index];
    }
    return SCREEN_ID_HOME;
}
```

### 5. 画面ごとのリソース

#### リソース管理方式

| 方式 | 説明 |
|------|------|
| 静的配置 | 全リソースをコンパイル時に配置 |
| 動的ロード | 必要時に外部メモリから読み込み |
| ハイブリッド | 頻繁に使うものは静的、他は動的 |

#### 画面別リソース一覧

| 画面 | 画像 | フォント | その他 |
|------|------|----------|--------|
| スプラッシュ | ロゴ画像 | - | - |
| ホーム | アイコン群 | 標準フォント | - |
| 設定 | - | 標準フォント | - |
| カメラ | - | - | カメラバッファ |

### 6. 遷移アニメーション（あれば）

| アニメーション | 説明 |
|----------------|------|
| フェード | 透明度変化 |
| スライド | 左右/上下移動 |
| なし | 即時切り替え |

実際の実装: ?

## 期待する成果物

### 1. 画面遷移状態遷移図

```
            ┌─────────────────────────────────────────┐
            │                                         │
            ▼                                         │
    ┌───────────────┐                                 │
    │   Splash      │──(3秒後)──→┌───────────────┐   │
    └───────────────┘             │    Home       │   │
                                  └───────┬───────┘   │
                                          │           │
                    ┌─────────────────────┼───────────┤
                    │                     │           │
                    ▼                     ▼           │
            ┌───────────────┐     ┌───────────────┐   │
            │   Settings    │     │    Camera     │───┘
            └───────────────┘     └───────────────┘
```

### 2. 主要な遷移処理のコード

画面遷移の実装コードを抽出し、コメント付きで説明してください。

### 3. 画面一覧表

| 画面ID | 画面名 | 遷移元 | 遷移先 | 主な機能 |
|--------|--------|--------|--------|----------|
| 0 | Splash | - | Home | 起動画面 |
| 1 | Home | Splash | Settings, Camera | メイン画面 |
| ... | ... | ... | ... | ... |

### 4. カスタマイズガイド

- 新しい画面の追加方法
- 遷移条件の変更方法
- アニメーションの追加方法（可能な場合）
