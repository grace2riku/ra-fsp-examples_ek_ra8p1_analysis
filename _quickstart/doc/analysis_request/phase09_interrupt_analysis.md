# Phase 9: 割込み解析

## カテゴリ
アーキテクチャ編

## 概要
使用している割込みを詳細に解析し、割込み処理の全体像を把握する。

## 解析要求事項

このプロジェクトで使用している割込みを詳細に解析してください。

### 1. 割込みベクタテーブル

調査対象ファイル：
- `vector_data.c`
- `vector_data.h`

#### ベクタテーブルの構造

| ベクタ番号 | 名称 | ハンドラ関数 | 用途 |
|-----------|------|-------------|------|
| 0 | Initial SP | - | スタック初期値 |
| 1 | Reset | Reset_Handler | リセット |
| 2 | NMI | NMI_Handler | NMI |
| 3 | HardFault | HardFault_Handler | ハードフォルト |
| ... | ... | ... | ... |
| 16+ | IRQ0 | xxx_isr | 周辺割込み |

### 2. 各割込みの詳細

登録されている割込みハンドラを一覧にしてください：

| IRQ番号 | 割込みソース | ハンドラ関数 | 優先度 | 用途 |
|---------|-------------|--------------|--------|------|
| ? | GLCDC_LINE_DETECT | glcdc_line_detect_isr | ? | LCD Vblank |
| ? | IIC_TXI | iic_master_txi_isr | ? | I2C送信 |
| ? | IIC_RXI | iic_master_rxi_isr | ? | I2C受信 |
| ? | IIC_ERI | iic_master_eri_isr | ? | I2Cエラー |
| ? | GPT_COUNTER_OVERFLOW | gpt_counter_overflow_isr | ? | タイマー |
| ... | ... | ... | ... | ... |

### 3. 主要な割込みの処理内容

#### LCDフレーム完了割込み（GLCDC）

```
割込み発生
    │
    ▼
glcdc_line_detect_isr()
    │
    ├─→ フラグクリア
    │
    ├─→ フレームバッファ切り替え（ダブルバッファの場合）
    │
    └─→ コールバック呼び出し → アプリケーション通知
```

#### タッチ検出割込み

```
割込み発生
    │
    ▼
外部割込みハンドラ or I2Cハンドラ
    │
    ├─→ タッチデータ読み出し
    │
    └─→ コールバック呼び出し → タッチイベント処理
```

#### カメラフレーム完了割込み（VIN/MIPI-CSI）

```
割込み発生
    │
    ▼
vin_frame_end_isr()
    │
    ├─→ フラグクリア
    │
    ├─→ バッファ更新
    │
    └─→ コールバック呼び出し → フレーム処理
```

### 4. DMA転送完了割込み

使用しているDMAチャネルと完了割込み：

| DMAチャネル | 転送内容 | 完了ハンドラ |
|-------------|----------|-------------|
| DMA0 | ? | ? |
| DTC | ? | ? |

### 5. タイマー割込み

| タイマー | 用途 | 周期 | ハンドラ |
|----------|------|------|----------|
| SysTick | RTOSティック | 1ms | SysTick_Handler |
| GPT? | ? | ? | ? |

### 6. RTOS用割込み

| 割込み | 用途 |
|--------|------|
| SysTick | システムティック |
| PendSV | コンテキストスイッチ |
| SVC | システムコール |

### 7. 割込み優先度の設計

#### 優先度レベル一覧

| 優先度 (数値小=高) | 用途 |
|-------------------|------|
| 0 | 予約 (NMI等) |
| 1-3 | 高優先度（リアルタイム処理） |
| 4-7 | 中優先度（通常処理） |
| 8-15 | 低優先度（バックグラウンド） |

#### 割込み間の優先順位関係

```
高優先度
    │
    ├── タイマー割込み（リアルタイム性重視）
    │
    ├── DMA完了割込み（データ転送継続）
    │
    ├── 通信割込み（I2C, SPI等）
    │
    ├── LCD割込み
    │
    └── その他
低優先度
```

## 期待する成果物

### 1. 割込み一覧表

すべての使用割込みを網羅した一覧表を作成してください。

### 2. 割込みシーケンス図

重要な割込み処理のシーケンス図を作成してください。

### 3. コールバック呼び出し経路

割込みからアプリケーションコールバックまでの呼び出しチェーンを図示してください：

```
IRQ発生 → ISR → FSP内部処理 → ユーザーコールバック
```

### 4. 割込み設定のコード例

割込みの登録・有効化のコード例を抽出してください。
